# GitHub Secrets Setup Guide

This document explains how to configure the required secrets for the CI/CD workflows.

## Required Secrets

Navigate to your GitHub repository → **Settings** → **Secrets and variables** → **Actions** → **New repository secret**

### 1. Railway Secrets

#### `RAILWAY_TOKEN`
**Purpose**: Authenticate with Railway CLI for deployments

**How to get it**:
```bash
# Login to Railway
railway login

# Generate a token
railway whoami --token
```

Or via Railway Dashboard:
1. Go to [railway.app/account/tokens](https://railway.app/account/tokens)
2. Click "Create Token"
3. Copy the token

---

#### `DATABASE_URL`
**Purpose**: PostgreSQL connection string for migrations

**How to get it**:
```bash
# Using Railway CLI
railway variables

# Or from Railway Dashboard
# Project → Variables → DATABASE_URL
```

Format: `postgresql://user:password@host:port/database`

---

### 2. Vercel Secrets

#### `VERCEL_TOKEN`
**Purpose**: Authenticate with Vercel CLI for deployments

**How to get it**:
1. Go to [vercel.com/account/tokens](https://vercel.com/account/tokens)
2. Click "Create Token"
3. Give it a name (e.g., "GitHub Actions")
4. Set scope to "Full Account"
5. Copy the token

---

#### `VERCEL_ORG_ID`
**Purpose**: Identify your Vercel organization

**How to get it**:
```bash
# Using Vercel CLI
cd frontend
vercel link

# Check .vercel/project.json
cat .vercel/project.json
```

Or from Vercel Dashboard:
1. Go to your team/account settings
2. Copy the "Team ID" or "User ID"

---

#### `VERCEL_PROJECT_ID`
**Purpose**: Identify your Vercel project

**How to get it**:
```bash
# After linking project
cat frontend/.vercel/project.json
```

Or from Vercel Dashboard:
1. Go to your project settings
2. Copy the "Project ID"

---

## Quick Setup Commands

### Railway Setup
```bash
# Get Railway token
railway login
railway whoami --token

# Get database URL
railway variables | grep DATABASE_URL
```

### Vercel Setup
```bash
# Install Vercel CLI
npm install -g vercel

# Link project
cd frontend
vercel link

# Get project details
cat .vercel/project.json
```

---

## Secrets Summary Table

| Secret Name | Required For | How to Obtain |
|-------------|--------------|---------------|
| `RAILWAY_TOKEN` | Backend deployment | Railway Dashboard or CLI |
| `DATABASE_URL` | Database migrations | Railway project variables |
| `VERCEL_TOKEN` | Frontend deployment | Vercel account tokens |
| `VERCEL_ORG_ID` | Vercel deployment | `.vercel/project.json` |
| `VERCEL_PROJECT_ID` | Vercel deployment | `.vercel/project.json` |

---

## Testing the Workflows

### Test Backend Deployment
```bash
# Make a change to backend
echo "// test" >> backend/src/index.ts

# Commit and push
git add .
git commit -m "test: trigger backend deployment"
git push origin main
```

### Test Frontend Deployment
```bash
# Make a change to frontend
echo "// test" >> frontend/app/page.tsx

# Commit and push
git add .
git commit -m "test: trigger frontend deployment"
git push origin main
```

### Test PR Checks
```bash
# Create a new branch
git checkout -b feature/test-pr

# Make changes
echo "// test" >> backend/src/index.ts

# Push and create PR
git add .
git commit -m "feat: test PR checks"
git push origin feature/test-pr
```

Then create a Pull Request on GitHub.

---

## Troubleshooting

### Railway Deployment Fails
- ✅ Check `RAILWAY_TOKEN` is valid
- ✅ Verify project ID in workflow matches your Railway project
- ✅ Ensure Railway service name is correct (`R11`)

### Vercel Deployment Fails
- ✅ Check `VERCEL_TOKEN` has correct permissions
- ✅ Verify `VERCEL_ORG_ID` and `VERCEL_PROJECT_ID` are correct
- ✅ Ensure project is linked: `cd frontend && vercel link`

### Database Migration Fails
- ✅ Check `DATABASE_URL` is correct
- ✅ Verify SQL files exist in `backend/src/database/`
- ✅ Test connection: `psql $DATABASE_URL -c "SELECT 1;"`

---

## Security Best Practices

1. **Never commit secrets** to the repository
2. **Rotate tokens** regularly (every 90 days)
3. **Use environment-specific secrets** for staging/production
4. **Limit token scope** to minimum required permissions
5. **Monitor secret usage** in GitHub Actions logs

---

## Additional Configuration

### Environment Variables in Vercel

After deployment, add these environment variables in Vercel Dashboard:

1. Go to your project → **Settings** → **Environment Variables**
2. Add:
   - `NEXT_PUBLIC_API_URL` = `https://r11-production.up.railway.app`
   - `NODE_ENV` = `production`

### Environment Variables in Railway

Verify these are set in Railway:

```bash
railway variables
```

Should include:
- `JWT_SECRET`
- `JWT_REFRESH_SECRET`
- `CORS_ORIGIN` (will be auto-updated by workflow)
- `DATABASE_URL` (auto-generated by Railway)

---

## Workflow Features

### Backend Deploy (`backend-deploy.yml`)
- ✅ TypeScript type checking
- ✅ Linting
- ✅ Docker build verification
- ✅ Railway deployment
- ✅ Database migrations
- ✅ Health check verification

### Frontend Deploy (`frontend-deploy.yml`)
- ✅ TypeScript type checking
- ✅ ESLint & Prettier
- ✅ Next.js build
- ✅ Vercel deployment
- ✅ Lighthouse performance tests
- ✅ Auto-update Railway CORS

### PR Checks (`pr-checks.yml`)
- ✅ Smart path detection (only checks changed code)
- ✅ Type checking
- ✅ Linting
- ✅ Unit tests
- ✅ Build verification
- ✅ Security audit
- ✅ Bundle size check
- ✅ Summary report

---

## Support

If you encounter issues:
1. Check GitHub Actions logs
2. Verify all secrets are set correctly
3. Test CLI commands locally first
4. Review Railway/Vercel deployment logs
